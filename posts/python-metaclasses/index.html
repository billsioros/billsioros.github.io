<!doctype html><html><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta http-equiv=Accept-CH content="DPR, Viewport-Width, Width"><meta property="og:image" content="./me.jpg"><link rel=icon href=/fav.png type=image/gif><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" media=print onload='this.media="all"'><noscript><link href="https://fonts.googleapis.com/css2?family=Alata&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel=stylesheet></noscript><link rel=stylesheet href=/css/font.css media=all><meta property="og:url" content="https://billsioros.github.io/posts/python-metaclasses/"><meta property="og:site_name" content="Vassilis Sioros | Software / Machine Learning Engineer"><meta property="og:title" content="Let's Talk Python Metaclasses"><meta property="og:description" content="Where Classes Get Their Magic!"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-17T13:52:18+44:21"><meta property="article:modified_time" content="2024-04-17T13:52:18+44:21"><meta property="article:tag" content="Python"><meta property="article:tag" content="Patterns"><meta property="article:tag" content="Metaclasses"><meta name=twitter:card content="summary"><meta name=twitter:title content="Let's Talk Python Metaclasses"><meta name=twitter:description content="Where Classes Get Their Magic!"><link rel=stylesheet href=/bootstrap-5/css/bootstrap.min.css media=all><link rel=stylesheet href=/css/header.css media=all><link rel=stylesheet href=/css/footer.css media=all><link rel=stylesheet href=/css/theme.css media=all><style>:root{--text-color:#343a40;--text-secondary-color:#6c757d;--background-color:#eaedf0;--secondary-background-color:#64ffda1a;--primary-color:#007bff;--brand-color:#007bff;--secondary-color:#f8f9fa;--text-color-dark:#e4e6eb;--text-secondary-color-dark:#b0b3b8;--background-color-dark:#18191a;--secondary-background-color-dark:#212529;--primary-color-dark:#007bff;--brand-color-dark:#ffffff;--secondary-color-dark:#212529}body{font-size:1rem;font-weight:400;line-height:1.5;text-align:left}html{background-color:var(--background-color)!important}body::-webkit-scrollbar{height:0;width:8px;background-color:var(--background-color)}::-webkit-scrollbar-track{border-radius:1rem}::-webkit-scrollbar-thumb{border-radius:1rem;background:#b0b0b0;outline:1px solid var(--background-color)}#search-content::-webkit-scrollbar{width:.5em;height:.1em;background-color:var(--background-color)}</style><meta name=description content="Where Classes Get Their Magic!"><meta name=author content="Vassilis Sioros"><meta property="og:image" content="https://billsioros.github.io/images/posts/metaclasses.png"><link rel=stylesheet href=/css/single.css><script defer src=/fontawesome-6/all-6.4.2.js></script><title>Let's Talk Python Metaclasses | Vassilis Sioros | Software / Machine Learning Engineer</title></head><body class=light><script>let localStorageValue=localStorage.getItem("pref-theme"),mediaQuery=window.matchMedia("(prefers-color-scheme: dark)").matches;switch(localStorageValue){case"dark":document.body.classList.add("dark");break;case"light":document.body.classList.remove("dark");break;default:mediaQuery&&document.body.classList.add("dark");break}</script><script>var prevScrollPos=window.pageYOffset;window.addEventListener("scroll",function(){let s=document.getElementById("profileHeader"),t=window.pageYOffset,n=!1,o=!1,i=o?prevScrollPos>t:t>0;i?s.classList.add("showHeaderOnTop"):n=!0,t===0&&(n=!0),n&&s.classList.remove("showHeaderOnTop"),prevScrollPos=t})</script><header id=profileHeader><nav class="pt-3 navbar navbar-expand-lg animate"><div class="container-fluid mx-xs-2 mx-sm-5 mx-md-5 mx-lg-5"><a class="navbar-brand primary-font text-wrap" href=/><img src=/fav.png width=30 height=30 class="d-inline-block align-top">
Vassilis Sioros</a><div class="d-flex justify-content-end" style=flex-grow:1><button id=theme-toggle style=margin-bottom:.5rem><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarContent aria-controls=navbarContent aria-expanded=false aria-label="Toggle navigation"><svg aria-hidden="true" height="24" viewBox="0 0 16 16" width="24" data-view-component="true"><path fill-rule="evenodd" d="M1 2.75A.75.75.0 011.75 2h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 2.75zm0 5A.75.75.0 011.75 7h12.5a.75.75.0 110 1.5H1.75A.75.75.0 011 7.75zM1.75 12a.75.75.0 100 1.5h12.5a.75.75.0 100-1.5H1.75z"/></svg></button><div class="collapse navbar-collapse text-wrap primary-font" style=flex-grow:0!important id=navbarContent><ul class="navbar-nav ms-auto text-center"><li class="nav-item navbar-text"><a class=nav-link href=/#about aria-label=about>About Me</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#experience aria-label=experience>Experience</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#education aria-label=education>Education</a></li><li class="nav-item navbar-text"><a class=nav-link href=/#projects aria-label=projects>Projects</a></li><li class="nav-item navbar-text"><a class=nav-link href=/posts title="Blog posts">Blog</a></li></ul></div></div></nav></header><div id=content><section id=single><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-md-12 col-lg-9"><div class=pr-lg-4><div class="title mb-5"><h1 class="text-center mb-4">Let's Talk Python Metaclasses</h1><h6 class="text-center mb-4">Where Classes Get Their Magic!</h6><div class=text-center>Apr 17, 2024
<span id=readingTime>min read
</span><small>| </small><a target=_blank href=https://colab.research.google.com/github/billsioros/billsioros.github.io/blob/master/static/code/python_metaclasses.ipynb><img src=https://colab.research.google.com/assets/colab-badge.svg alt="Open In Colab"></a></div></div><div class=featured-image><img class="img-fluid mx-auto d-block" src=/images/posts/metaclasses.png alt="Let's Talk Python Metaclasses"></div><article class="page-content p-2"><p>Python metaclasses give you control over class creation and behavior. They act as blueprints, shaping inheritance and behavior. Just as classes govern instances, metaclasses oversee classes.</p><h2 id=a-little-know-gem>A little know gem</h2><p>Ever heard of a metaclass called <code>abc.ABC</code>? Chances are you&rsquo;ve been using it without even realizing it. This little gem is pretty handy for crafting abstract base classes (ABCs) in Python. It&rsquo;s like the rulebook that says, <em>&ldquo;Hey, if you&rsquo;re a subclass, you gotta follow these rules and implement these methods.&rdquo;</em></p><p>Take a look at <code>Vehicle</code> — it&rsquo;s an abstract base class setting the stage. And here comes <code>Car</code>, ready to roll as a subclass. But hey, to be a proper <code>Car</code>, it&rsquo;s gotta have that <code>move</code> method implemented. Thanks to <code>abc.ABC</code>, Python keeps everyone in line, making sure subclasses play by the rules.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span><span class=p>,</span> <span class=n>abstractmethod</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Vehicle</span><span class=p>(</span><span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nd>@abstractmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>move</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Car</span><span class=p>(</span><span class=n>Vehicle</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>move</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Car is moving&#34;</span>
</span></span></code></pre></div><h2 id=lets-dive-deeper>Let&rsquo;s Dive Deeper!</h2><p>Metaclasses often roll out the red carpet for the <code>__new__</code> and <code>__init__</code> magic methods, letting you customize class creation like a pro.</p><ul><li><code>__new__</code> is like the early bird of class creation, chirping before the class is even born. It&rsquo;s the one responsible for bringing the class object into existence. Here&rsquo;s where you can tweak base classes, but watch out for Method Resolution Order (MRO) issues if you&rsquo;re not careful.</li><li>Now, <code>__init__</code> strolls in fashionably late, after the class has been born. Its job is to spruce up the class object once it&rsquo;s out there in the world. When <code>__init__</code> arrives, the class&rsquo;s namespace is already filled with goodies, like attributes and all. So, it&rsquo;s your chance to add those final touches, knowing that the class is ready to rock and roll.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Meta</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>attrs</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Meta.__new__ called with metaclass: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=bp>cls</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Call the __new__ method of the superclass (type) to create the class</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>attrs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>attrs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Meta.__init__ called for class: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=bp>cls</span><span class=o>.</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Display class-level attributes</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;  Class attributes for </span><span class=si>%s</span><span class=s2>: </span><span class=si>%s</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>%</span> <span class=p>(</span><span class=bp>cls</span><span class=o>.</span><span class=vm>__name__</span><span class=p>,</span> <span class=nb>getattr</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=s2>&#34;class_attribute&#34;</span><span class=p>,</span> <span class=kc>None</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Call the __init__ method of the superclass (type) to initialize the class</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>attrs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Foo</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>Meta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></div><pre><code>Meta.__new__ called with metaclass: Meta
Meta.__init__ called for class: Foo
  Class attributes for Foo: None
</code></pre><h2 id=our-first-attempt>Our first attempt</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>UppercaseAttributeMeta</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>dct</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>uppercase_attrs</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>attr</span><span class=o>.</span><span class=n>upper</span><span class=p>():</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>attr</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>dct</span><span class=o>.</span><span class=n>items</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>attr</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;__&#34;</span><span class=p>)</span>  <span class=c1># Exclude magic methods</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>uppercase_attrs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Bar</span><span class=p>(</span><span class=n>metaclass</span><span class=o>=</span><span class=n>UppercaseAttributeMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=s2>&#34;hello&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>Bar</span><span class=o>.</span><span class=n>MESSAGE</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>hello
</code></pre><p>So, what&rsquo;s happening here?</p><p>We&rsquo;re creating a metaclass called <code>UppercaseAttributeMeta</code>. When we create a class and set its metaclass to <code>UppercaseAttributeMeta</code>, it&rsquo;s like telling Python, &ldquo;Hey, when you create this class, make sure all the attribute names are in uppercase!&rdquo;</p><p>Inside our metaclass, we have a special method called <code>__new__</code>. This method is like the constructor for our class. It gets called when Python is creating a new class. Inside <code>__new__</code>, we&rsquo;re basically saying:</p><ol><li>&ldquo;Hey, Python, give me all the attributes (<code>attr</code>) and their values (<code>value</code>) that are inside this class (<code>dct</code>).&rdquo;</li><li>&ldquo;Now, let&rsquo;s check each attribute. If it&rsquo;s not a special magic method (like <code>__init__</code>), let&rsquo;s convert its name to uppercase and store it in a new dictionary (<code>uppercase_attrs</code>).&rdquo;</li><li>&ldquo;Okay, Python, go ahead and create the class for me, but use this new dictionary with the uppercase attribute names and their values.&rdquo;</li></ol><p>Then, we define a class called <code>Bar</code> and tell Python to use our <code>UppercaseAttributeMeta</code> metaclass. So, any attributes we define in <code>Bar</code> will automatically have their names converted to uppercase.</p><h2 id=json-made-easy>JSON Made Easy</h2><p>Imagine you&rsquo;re developing an application that interacts heavily with JSON data. As part of your project, you find yourself repeatedly defining classes to represent different JSON structures. This manual process not only consumes time but also increases the likelihood of errors creeping into your codebase.</p><p>Your objective is to devise a solution that automates the creation of these classes based on JSON schemas. By doing so, you aim to ensure that the classes generated adhere strictly to the schema specifications. This automation would significantly enhance code maintainability and reduce the potential for bugs when handling JSON data.</p><p>Enter the <code>JsonSerializableMeta</code> metaclass! When a class is being created, this metaclass swoops in to see if there&rsquo;s a schema attribute present. If it finds one, it calls on the <code>ObjectBuilder</code> from the <code>python_jsonschema_objects</code> package to craft classes that mirror the schema. These classes are then added as bases to the original class. This ensures that schema rules are enforced, simplifying validation and allowing for seamless JSON object serialization and deserialization.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABCMeta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>python_jsonschema_objects</span> <span class=kn>import</span> <span class=n>ObjectBuilder</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>python_jsonschema_objects.classbuilder</span> <span class=kn>import</span> <span class=n>ProtocolBase</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>JsonSerializableMeta</span><span class=p>(</span><span class=n>ABCMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>attrs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s2>&#34;JsonSerializableMeta&#34;</span><span class=p>:</span>  <span class=c1># noqa: D102</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>schema</span> <span class=o>=</span> <span class=n>attrs</span><span class=p>[</span><span class=s2>&#34;schema&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=p>(</span><span class=ne>KeyError</span><span class=p>,</span> <span class=ne>AttributeError</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>bases</span><span class=p>,</span> <span class=n>attrs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>builder</span> <span class=o>=</span> <span class=n>ObjectBuilder</span><span class=p>(</span><span class=n>schema</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>classes</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=n>build_classes</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>strict</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>named_only</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>standardize_names</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>json_schema</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>classes</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=p>(</span><span class=o>*</span><span class=n>bases</span><span class=p>,</span> <span class=n>json_schema</span><span class=p>),</span> <span class=n>attrs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>JsonSerializable</span><span class=p>(</span><span class=n>ProtocolBase</span><span class=p>,</span> <span class=n>metaclass</span><span class=o>=</span><span class=n>JsonSerializableMeta</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span></code></pre></div><p>Let&rsquo;s now define a <code>User</code> class using the JSON schema for Spotify users.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>JsonSerializable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>schema</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;https://dotify.com/track.user.json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;$schema&#34;</span><span class=p>:</span> <span class=s2>&#34;http://json-schema.org/draft-04/schema#&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;User&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;display_name&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;display_name&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;external_urls&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;patternProperties&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;^.*$&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>}},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;minProperties&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;href&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/users/.*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=s2>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;^user$&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;uri&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=s2>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;uri&#34;</span><span class=p>,</span> <span class=s2>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;spotify:user:.*&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><p><code>ObjectBuilder</code> can take the schema directly or a path to a JSON schema file. So, the schema attribute at the class level might not always be a dictionary. Here&rsquo;s an example where we end up with the same User class, no matter which way we go:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>schema</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;https://dotify.com/track.user.json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;$schema&#34;</span><span class=p>:</span> <span class=s2>&#34;http://json-schema.org/draft-04/schema#&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=s2>&#34;User&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;display_name&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;display_name&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;external_urls&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;patternProperties&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;^.*$&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>}},</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;minProperties&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;href&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;https://api.spotify.com/v1/users/.*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=s2>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;^user$&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;uri&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span> <span class=s2>&#34;format&#34;</span><span class=p>:</span> <span class=s2>&#34;uri&#34;</span><span class=p>,</span> <span class=s2>&#34;pattern&#34;</span><span class=p>:</span> <span class=s2>&#34;spotify:user:.*&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>schema_path</span> <span class=o>=</span> <span class=s2>&#34;./schema.json&#34;</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>schema_path</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>schema</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>JsonSerializable</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>schema</span> <span class=o>=</span> <span class=n>schema_path</span>
</span></span></code></pre></div><ul><li>When you create a <code>User</code> object with all the required info, everything kicks off smoothly.</li><li>But if you try to make a <code>User</code> without providing all the necessary details, it&rsquo;s like hitting a roadblock—validation errors pop up. This shows how the class sticks to its rules, making sure everything&rsquo;s in line with the schema during object creation.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>User</span><span class=p>(</span><span class=n>display_name</span><span class=o>=</span><span class=s2>&#34;Vassilis Sioros&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>User</span> <span class=n>display_name</span><span class=o>=&lt;</span><span class=n>Literal</span><span class=o>&lt;</span><span class=nb>str</span><span class=o>&gt;</span> <span class=n>Vassilis</span> <span class=n>Sioros</span><span class=o>&gt;</span> <span class=n>external_urls</span><span class=o>=</span><span class=kc>None</span> <span class=n>href</span><span class=o>=</span><span class=kc>None</span> <span class=nb>id</span><span class=o>=</span><span class=kc>None</span> <span class=nb>type</span><span class=o>=</span><span class=kc>None</span> <span class=n>uri</span><span class=o>=</span><span class=kc>None</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=n>User</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ValidationError</span><span class=p>:</span> <span class=s1>&#39;[&#39;</span><span class=n>display_name</span><span class=s1>&#39;]&#39;</span> <span class=n>are</span> <span class=n>required</span> <span class=n>attributes</span> <span class=k>for</span> <span class=n>User</span>
</span></span></code></pre></div><p>It&rsquo;s like having a super-efficient assistant that automates all the boring class-building tasks for you. With metaclasses doing the heavy lifting, you can whip up complex class structures from JSON schemas with just a few lines of code. It&rsquo;s like getting a gourmet meal with minimal effort in the kitchen – metaclasses make complicated tasks seem like a breeze.</p><p>Alright, folks, that&rsquo;s a wrap for today&rsquo;s dive into Python metaclasses! I hope you&rsquo;ve enjoyed uncovering their hidden powers alongside me. Until next time, keep exploring & keep coding!</p></article></div></div><div class="col-sm-12 col-md-12 col-lg-3"><div id=stickySideBar class=sticky-sidebar><aside class=toc><h5>Contents</h5><div class=toc-content><nav id=TableOfContents><ul><li><a href=#a-little-know-gem>A little know gem</a></li><li><a href=#lets-dive-deeper>Let&rsquo;s Dive Deeper!</a></li><li><a href=#our-first-attempt>Our first attempt</a></li><li><a href=#json-made-easy>JSON Made Easy</a></li></ul></nav></div></aside><aside class=tags><ul class="tags-ul list-unstyled list-inline mb-0 text-center"><li class="list-inline-item m-1"><a href=https://billsioros.github.io/tags/python target=_blank>Python</a></li><li class="list-inline-item m-1"><a href=https://billsioros.github.io/tags/patterns target=_blank>Patterns</a></li><li class="list-inline-item m-1"><a href=https://billsioros.github.io/tags/metaclasses target=_blank>Metaclasses</a></li></ul></aside><aside class="social text-center"><div class="social-content mb-0"><ul class="list-inline mb-0"><li class="list-inline-item text-center"><a target=_blank href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fbillsioros.github.io%2fposts%2fpython-metaclasses%2f"><i class="fab fa-linkedin"></i></a></li><li class="list-inline-item text-center"><a target=_blank href="https://twitter.com/share?text=Let%27s%20Talk%20Python%20Metaclasses&url=https%3a%2f%2fbillsioros.github.io%2fposts%2fpython-metaclasses%2f"><i class="fab fa-twitter"></i></a></li><li class="list-inline-item text-center"><a target=_blank href='mailto:?subject=Let%27s%20Talk%20Python%20Metaclasses&amp;body=Check%20out%20this%20site https%3a%2f%2fbillsioros.github.io%2fposts%2fpython-metaclasses%2f'><i class="fa fa-envelope"></i></a></li></ul></div></aside></div></div></div><div class=row><div class="col-sm-12 col-md-12 col-lg-9 p-4"></div></div></div><button class="p-2 px-3" onclick=topFunction() id=topScroll>
<i class="fas fa-angle-up"></i></button></section><div class=progress><div id=scroll-progress-bar class=progress-bar role=progressbar aria-valuenow=0 aria-valuemin=0 aria-valuemax=100></div></div><script src=/js/scrollProgressBar.js></script><script>var topScroll=document.getElementById("topScroll");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?topScroll.style.display="block":topScroll.style.display="none"}function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}let stickySideBarElem=document.getElementById("stickySideBar"),stickyNavBar=!0;if(stickyNavBar){let e=document.getElementById("profileHeader"),t=e.offsetHeight+15;stickySideBarElem.style.top=t+"px"}else stickySideBarElem.style.top="50px"</script><script src=/js/readingTime.js></script></div><footer class="d-flex flex-column justify-content-end" style=min-height:195px><div class="text-center pt-2"></div><div class="container py-4"><div class="row justify-content-center"><div class="col-md-4 text-center">&copy; 2024 All rights reserved</div></div></div></footer><script src=/bootstrap-5/js/bootstrap.bundle.min.js></script><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))});var tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')),tooltipList=tooltipTriggerList.map(function(e){return new bootstrap.Tooltip(e)})</script><script src=/js/search.js></script></body></html>